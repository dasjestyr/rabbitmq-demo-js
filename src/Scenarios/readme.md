# Communication Scenario Demo

This scenario illustrates the following
 - A service (ProducerService) makes a direct request of another service (NotificationService). It does this by calling the `.Send(...)` method on the client. The message is thus sent directly to the NotificationService's exchange.
 - The Notification service simulates the handling of the message and then responds. Instead of responding directly to the service that made the request (tight coupling), it publishes the `NotificationSent` event to a topic to which the sender is assumed to be subscribed. It also then publishes an event to a statistics topic, from which it expects no response (e.g. streaming analytics)
 - Since the ProducerService is subscribed to the notifications topic, it receives the response message and simulates updating its records. It does this by queuing the process (`SendLocal(...)`) in its own queue. When it gets around to processing those messages, it then publishes the fact that it received the confirmation to the statistics topic.
 - The statistics topic simulates receiving all events related to notifications and calculating statistics.

## This demonstrates the following principles
 - Command semantics `.Send(...)` -- sends a command to a specific service. This implies that there is only a single consumer of that queue
 - Event semantics `.Publish(...)` -- sends an event to a topic where zero or more consumers could consume it.
   - By use of the routing key, the ProducerService can be selective about which messages in the notifications topic it is interested. 
 - Deferral semantics `.PublishLocal(...)` -- sends a message to ourselves (the publishing service) so that we can process it on our own time, in case it is a busy service.
 - The correlationId is used to group related messages together. You'll notice in the StatsReceiver service, that all messages related to the original email request share the same correlationId because they are part of the same prcoess, even though they were generated by two different services. 


## To run the scenario
  - Open 3 terminals in the `/src/Scenarios` directory
  - In one terminal, run `node StatsReceiver.js`
  - In a different terminal, run `node NotificationService.js`
  - In the final terminal, run `node ProducerService`
